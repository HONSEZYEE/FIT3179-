{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 1020,
  "height": 520,

  "data": {
    "url": "https://raw.githubusercontent.com/HONSEZYEE/FIT3179-/main/Global_YouTube_Statistics_UTF8.csv"
  },

  "params": [
    {
      "name": "startYear",
      "value": 2010,
      "bind": { "input": "range", "min": 2005, "max": 2025, "step": 1, "name": "Start Year: " }
    },
    {
      "name": "endYear",
      "value": 2023,
      "bind": { "input": "range", "min": 2005, "max": 2025, "step": 1, "name": "End Year: " }
    },
    {
      "name": "selectedCountry",
      "value": "United States",
      "bind": {
        "input": "select",
        "options": ["United States", "India", "South Korea", "Russia", "United Kingdom", "Canada", "Japan", "Brazil"],
        "name": "Select Country: "
      }
    }
  ],

  "transform": [
    { "filter": "isValid(datum.created_year) && isValid(datum.Country)" },
    { "calculate": "toNumber(datum.created_year)", "as": "year" },
    { "filter": "datum.Country == selectedCountry" },
    { "aggregate": [{ "op": "count", "as": "yearly_count" }], "groupby": ["created_year", "Country"] },
    {
      "window": [{ "op": "sum", "field": "yearly_count", "as": "cum_count" }],
      "sort": [{ "field": "created_year", "order": "ascending" }],
      "groupby": ["Country"]
    },
    { "filter": "datum.created_year >= startYear && datum.created_year <= endYear" }
  ],

  "encoding": {
    "x": { "field": "created_year", "type": "ordinal", "title": "Year", "axis": { "format": "d" } },
    "y": { "field": "yearly_count", "type": "quantitative", "title": "New Channels", "axis": { "orient": "left" } }
  },

  "layer": [
    {
      "mark": { "type": "area", "interpolate": "monotone", "opacity": 0.25, "color": "#EAB308" },
      "encoding": {
        "tooltip": [
          { "field": "created_year", "title": "Year" },
          { "field": "yearly_count", "title": "New Channels" },
          { "field": "cum_count", "title": "Cumulative" }
        ]
      }
    },
    {
      "mark": { "type": "line", "interpolate": "monotone", "strokeWidth": 2, "color": "#7C3AED" },
      "encoding": {
        "tooltip": [
          { "field": "created_year", "title": "Year" },
          { "field": "yearly_count", "title": "New Channels" },
          { "field": "cum_count", "title": "Cumulative" }
        ]
      }
    },
    { "mark": { "type": "point", "filled": true, "size": 60, "color": "#7C3AED" } }
  ],

  "resolve": { "scale": { "y": "shared" } },

  "config": {
    "axisY": { "domain": true, "ticks": true, "grid": true },
    "view": { "stroke": null },
    "background": "white"
  }
}
